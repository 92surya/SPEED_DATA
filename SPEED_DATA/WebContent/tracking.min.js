angular.module("chartApp",["n3-line-chart","ui.bootstrap.datetimepicker"]).controller("ChartControl",function(e,t,a){function n(e){null!==e.getAnimation()?e.setAnimation(null):e.setAnimation(google.maps.Animation.BOUNCE)}function o(){r(null)}function r(e){for(var a=0;a<t.markers.length;a++)t.markers[a].setMap(e)}function d(){o(),t.markers=[]}getDrivers=function(){e.get("/SPEED_DATA/getDrivers").success(function(e){console.log(e),t.driverList=e})},getDrivers(),getVehicles=function(){e.get("/SPEED_DATA/getVehicles").success(function(e){console.log(e),t.vehicleList=e})},getVehicles(),t.updateDriver=function(e){t.data.selectedVehicle={id:t.data.selectedDriver},t.data.selectedDriver={id:t.data.selectedDriver}},t.updateVehicle=function(e){t.data.selectedDriver={id:t.data.selectedVehicle},t.data.selectedVehicle={id:t.data.selectedVehicle}},t.logout=function(){e.get("/SPEED_DATA/getLogout").success(function(e){a.location.href="/SPEED_DATA"})},t.loadChartAndMap=function(e,n){angular.isUndefined(t.data)||angular.isUndefined(t.data.selectedVehicle)||angular.isUndefined(t.data.dateDropDownInput1)||angular.isUndefined(t.data.dateDropDownInput2)?a.alert("Please select a driver, from-datetime and upto-datetime"):t.data.dateDropDownInput2<=t.data.dateDropDownInput1?a.alert("Please select upto-datetime after from-datetime"):(t.loadChart(e,n),t.loadMap(e,n))},t.loadChart=function(n,o){angular.isUndefined(t.data)||angular.isUndefined(t.data.selectedVehicle)||angular.isUndefined(t.data.dateDropDownInput1)||angular.isUndefined(t.data.dateDropDownInput2)?a.alert("Please select a driver, from-datetime and upto-datetime"):t.data.dateDropDownInput2<=t.data.dateDropDownInput1?a.alert("Please select upto-datetime after from-datetime"):(console.log(n),e({method:"POST",url:"/SPEED_DATA/getChartPoints",data:{driverid:n.selectedDriver.id,fromDate:n.dateDropDownInput1,uptoDate:n.dateDropDownInput2,filter:o},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){if(e.errors)t.errorName=e.errors.name,t.errorUserName=e.errors.username,t.errorEmail=e.errors.email;else{for(console.log(e),t.data2=[],i=0;i<e.chartList.length;i++)t.chartElement={datetime:"",speed:0},t.chartElement.speed=e.chartList[i].speed,t.chartElement.datetime=new Date(e.chartList[i].datetime),t.data2.push(t.chartElement);t.data3={chartList:t.data2},t.chartData=t.data3,console.log(t.data2)}}))};var s={zoom:6,center:new google.maps.LatLng(40,-98),mapTypeId:google.maps.MapTypeId.TERRAIN};t.map=new google.maps.Map(document.getElementById("map"),s),t.markers=[];var l=new google.maps.InfoWindow,c=new google.maps.Polyline({strokeColor:"#00F600",strokeOpacity:1,strokeWeight:2}),p=function(e){var a=c.getPath(),o=new google.maps.Marker({map:t.map,position:new google.maps.LatLng(e.lat,e.lng),animation:google.maps.Animation.DROP,title:e.date});a.push(new google.maps.LatLng(e.lat,e.lng)),o.content='<div class="infoWindowContent">'+e.date+" "+e.minutes+"</div>",google.maps.event.addListener(o,"click",function(){n(o),l.setContent("<h2> Time </h2>"+o.content),l.open(t.map,o)}),t.markers.push(o)};t.loadMap=function(a,n){console.log(a),e({method:"POST",url:"/SPEED_DATA/getLatLngValues",data:{driverid:a.selectedDriver.id,fromDate:a.dateDropDownInput1,uptoDate:a.dateDropDownInput2,filter:n},headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){if(e.errors)t.errorName=e.errors.name,t.errorUserName=e.errors.username,t.errorEmail=e.errors.email;else{console.log(e),d();var a=e;for(c=new google.maps.Polyline({strokeColor:"#00F600",strokeOpacity:1,strokeWeight:2}),t.map=new google.maps.Map(document.getElementById("map"),s),t.markers=[],path=[],i=0;i<a.length;i++)p(a[i]);c.setMap(t.map)}})};var m=[{date:"2016-02-01",minutes:"02:34",lat:40.7,lng:-98.4}];for(i=0;i<m.length;i++)p(m[i]);t.openInfoWindow=function(e,t){e.preventDefault(),google.maps.event.trigger(t,"click")},t.options={margin:{top:5},series:[{axis:"y",dataset:"chartList",key:"speed",label:"speed",color:"hsla(88, 48%, 48%, 1)",type:["line"],visible:!0}],axes:{x:{key:"datetime",type:"date",ticks:6}}},t.chartData={chartList:[{time:0,datetime:new Date("2016-03-01 18:17:23"),speed:0},{time:1,datetime:new Date("2016-03-02 23:45:42"),speed:6},{time:2,datetime:new Date("2016-03-03 21:51:20"),speed:20},{time:3,datetime:new Date("2016-03-04 02:12:34"),speed:10},{time:4,datetime:new Date("2016-03-05 20:15:57"),speed:16}]}});